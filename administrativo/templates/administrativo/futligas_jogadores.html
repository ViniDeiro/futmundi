{% extends "administrativo/base.html" %}
{% load static %}

{% block title %}Futligas Jogadores{% endblock %}

{% block content %}
<style>
    /* Efeitos visuais para feedback */
    .processing {
        opacity: 0.7;
        pointer-events: none;
        position: relative;
    }
    
    .processing::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.5);
        z-index: 1;
    }
    
    .highlight {
        animation: highlightRow 2s ease-out;
    }
    
    @keyframes highlightRow {
        0% { background-color: #fff3cd; }
        100% { background-color: transparent; }
    }
    
    /* Melhora a aparência dos botões desabilitados */
    .btn:disabled {
        cursor: not-allowed;
        opacity: 0.6;
    }
</style>

<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="tabs-container">
                <ul class="nav nav-tabs" role="tablist">
                    <li><a class="nav-link active" data-toggle="tab" href="#requisitos">Requisitos</a></li>
                    <li><a class="nav-link" data-toggle="tab" href="#premios">Prêmios</a></li>
                    <li><a class="nav-link" data-toggle="tab" href="#premiacao">Premiação</a></li>
                </ul>
                <div class="tab-content">
                    <div id="requisitos" class="tab-pane active">
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-4">
                                    <form id="nivelForm" method="post" action="{% url 'administrativo:futliga_jogador_novo' %}" enctype="multipart/form-data" class="mt10">
                                        {% csrf_token %}
                                        <div class="form-group col-lg-6">
                                            <input type="text" id="nome" name="name" class="form-control" required>
                                            <label class="form-control-placeholder" for="nome">Nome</label>
                                        </div>
                                        <div class="card ui-card-shadow ui-widget ui-widget-content ui-corner-all card-small ml15">
                                            <div class="card-heading">
                                                <h5>Imagem</h5>
                                            </div>
                                            <div class="card-content" style="position: relative; padding: 0;">
                                                <div id="image-preview" style="display: flex; justify-content: center; align-items: center; min-height: 48px; margin-top: -7px;">
                                                    <i class="fa fa-file-image-o" style="font-size: 48px; color: #ccc; cursor: pointer;" onclick="document.getElementById('image').click()"></i>
                                                </div>
                                                <input type="file" id="image" name="image" class="input-image" accept="image/*" style="display: none;">
                                            </div>
                                        </div>
                                        <div class="form-group mt10">
                                            <div class="col-lg-12">
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <input type="number" min="0" id="participantes" name="players" class="form-control" required>
                                                        <label class="form-control-placeholder" for="participantes">Qtde Participantes</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group mt10">
                                            <div class="col-lg-12">
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <input type="number" min="0" id="craques" name="premium_players" class="form-control" required>
                                                        <label class="form-control-placeholder" for="craques">Qtde Craques</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group mt20">
                                            <div class="col-lg-12">
                                                <div class="row">
                                                    <div class="col-lg-6 mt5">
                                                        <div class="i-checks">
                                                            <label>
                                                                <input type="checkbox" name="owner_premium" id="owner_premium">
                                                                <span class="ml5">Dono Craque</span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group mt25">
                                            <div class="col-lg-12">
                                                <button type="submit" class="btn btn-primary" id="btnAdicionar"><i class="fa fa-plus mr5"></i> Adicionar</button>
                                                <button type="button" class="btn btn-primary ml20" data-toggle="modal" data-target="#modalImportar"><i class="fa fa-upload mr5"></i> Importar</button>
                                            </div>
                                        </div>
                                    </form>
                                    <!-- Form oculto para importação -->
                                    <form id="importForm" style="display: none;">
                                        {% csrf_token %}
                                        <input type="file" name="file" id="importFile" accept=".xlsx,.xls">
                                    </form>
                                </div>
                                <div class="col-lg-8">
                                    <div class="group-options-right">
                                        <a href="{% url 'administrativo:futliga_jogador_exportar' %}" class="btn btn-default btn-sm" title="Exportar"><i class="glyphicon glyphicon-download-alt"></i></a>
                                    </div>
                                    <div class="table-responsive">
                                        <table id="table" class="table table-bordered table-hover table-sm">
                                            <thead>
                                                <tr>
                                                    <th class="per20">Nível</th>
                                                    <th class="per15 center-middle">Imagem</th>
                                                    <th class="per15">Participantes</th>
                                                    <th class="per10">Craques</th>
                                                    <th class="per15">Dono Craque</th>
                                                    <th class="per15">Ações</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for level in levels %}
                                                <tr>
                                                    <td class="align-middle">{{ level.name }}</td>
                                                    <td class="center-middle align-middle">
                                                        {% if level.image %}
                                                            <img src="{{ level.image.url }}" style="width: 32px; height: 32px; object-fit: contain;" alt="Imagem">
                                                        {% endif %}
                                                    </td>
                                                    <td class="align-middle">{{ level.players }}</td>
                                                    <td class="align-middle">{{ level.premium_players }}</td>
                                                    <td class="align-middle">{% if level.owner_premium %}Sim{% else %}Não{% endif %}</td>
                                                    <td class="align-middle">
                                                        <div>
                                                            <button type="button" class="btn btn-info btn-xs mr5 btnEditar" title="Editar" data-id="{{ level.id }}">
                                                                <i class="glyphicon glyphicon-pencil"></i>
                                                            </button>
                                                            <button type="button" class="btn btn-danger btn-xs mr5 btnExcluir" title="Excluir" data-id="{{ level.id }}">
                                                                <i class="glyphicon glyphicon-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="premios" class="tab-pane">
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <button type="button" class="btn btn-success btn-sm" id="addPremioRow">
                                        <i class="fa fa-plus"></i> Adicionar Prêmio
                                    </button>
                                    <div class="table-responsive mt15">
                                        <table id="premiosTable" class="table table-bordered table-hover">
                                            <thead>
                                                <tr>
                                                    <th class="per15">Posição</th>
                                                    <th class="per15 center-middle">Imagem</th>
                                                    <th class="per15">Iniciante</th>
                                                    <th class="per15">Nacional</th>
                                                    <th class="per15">Internacional</th>
                                                    <th class="per15">Ações</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="premio-row">
                                                    <td>
                                                        <input type="number" class="form-control position-input" min="1" value="1">
                                                    </td>
                                                    <td class="center-middle">
                                                        <div class="image-preview-container">
                                                            <input type="file" class="premio-image" accept="image/*" style="display: none;">
                                                            <div class="premio-image-preview">
                                                                <i class="fa fa-file-image-o"></i>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <input type="number" class="form-control iniciante-input" min="0">
                                                    </td>
                                                    <td>
                                                        <input type="number" class="form-control nacional-input" min="0">
                                                    </td>
                                                    <td>
                                                        <input type="number" class="form-control internacional-input" min="0">
                                                    </td>
                                                    <td>
                                                        <button type="button" class="btn btn-danger btn-xs remove-premio">
                                                            <i class="glyphicon glyphicon-trash"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="premiacao" class="tab-pane">
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="ibox-title">
                                        <h5>Ranking Semanal</h5>
                                        <form class="mt15">
                                            <div class="form-group col-lg-12">
                                                <div class="row">
                                                    <div class="form-group col-lg-4">
                                                        <label class="control-label" for="dia-premiacao">Dia da Semana</label>
                                                        <select class="form-control js-example-basic-single"
                                                                id="dia-premiacao" style="width: 80%">
                                                            <option value="Segunda">Segunda</option>
                                                            <option value="Terça">Terça</option>
                                                            <option value="Quarta">Quarta</option>
                                                            <option value="Quinta">Quinta</option>
                                                            <option value="Sexta">Sexta</option>
                                                            <option value="Sábado">Sábado</option>
                                                            <option value="Domingo">Domingo</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-lg-4">
                                                        <label class="control-label" for="hora-premiacao">
                                                            Horário
                                                            Premiação
                                                        </label>
                                                        <div class="input-group clockpicker" data-autoclose="true" style="width: 80%">
                                                            <input type="text" class="form-control" id="weekly-time">
                                                            <span class="input-group-addon">
                                                                <span class="fa fa-clock-o"></span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="ibox-title">
                                        <h5>Ranking Temporada</h5>
                                        <form class="mt15">
                                            <div class="form-group col-lg-12">
                                                <div class="row">
                                                    <div class="form-group col-lg-4">
                                                        <label class="control-label" for="mes-ano-premiacao">Mês do Ano</label>
                                                        <select class="form-control js-example-basic-single"
                                                                id="mes-ano-premiacao" style="width: 80%">
                                                            <option value="Janeiro">Janeiro</option>
                                                            <option value="Fevereiro">Fevereiro</option>
                                                            <option value="Março">Março</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-lg-4">
                                                        <label class="control-label" for="dia-ano-premiacao">Dia do Ano</label>
                                                        <select class="form-control js-example-basic-single"
                                                                id="dia-ano-premiacao" style="width: 80%">
                                                            <option value="Um">1</option>
                                                            <option value="Dois">2</option>
                                                            <option value="Tres">3</option>
                                                            <option value="Quatro">4</option>
                                                            <option value="Cinco">5</option>
                                                            <option value="Seis">6</option>
                                                            <option value="Sete">7</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group col-lg-4">
                                                        <label class="control-label" for="hora-premiacao">
                                                            Horário
                                                            Premiação
                                                        </label>
                                                        <div class="input-group clockpicker" data-autoclose="true" style="width: 80%">
                                                            <input type="text" class="form-control" id="season-time">
                                                            <span class="input-group-addon">
                                                                <span class="fa fa-clock-o"></span>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default col-lg-12 mtm25 p15">
                <button type="button" class="btn btn-success ml20" id="successToast"><i class="glyphicon glyphicon-save mr5"></i> Salvar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmação de exclusão -->
<div class="modal fade" id="modalConfirmDelete" tabindex="-1" role="dialog" aria-labelledby="modalConfirmDeleteLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalConfirmDeleteLabel">Confirmar Exclusão</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir este nível?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="btnConfirmDelete">Excluir</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de importação -->
<div class="modal fade" id="modalImportar" tabindex="-1" role="dialog" aria-labelledby="modalImportarLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalImportarLabel">Importar Níveis</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Selecione um arquivo Excel (.xls ou .xlsx) para importar os níveis.</p>
                <input type="file" id="importFile" accept=".xls,.xlsx" style="display: none;">
                <button type="button" class="btn btn-primary" onclick="$('#importFile').click()">Selecionar Arquivo</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="{% static 'administrativo/js/futligas-niveis.js' %}"></script>
<script src="{% static 'administrativo/js/plugins/toastr/toastr.min.js' %}"></script>
<script src="{% static 'administrativo/js/plugins/dataTables/datatables.min.js' %}"></script>
<script src="{% static 'administrativo/js/plugins/dataTables/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'administrativo/js/futligas_jogadores.js' %}"></script>
{% endblock %}
